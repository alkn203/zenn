---
title: "数字の表示"
---

---
title: 【phina.js】ゲーム作成チュートリアル（15パズル）（その２）【数字の表示】
tags: phina.js JavaScript HTML5 ゲーム制作 チュートリアル
author: alkn203
slide: false
---
※これまでのTipsは[phina.js チュートリアル集](https://qiita.com/alkn203/items/2150f739d383b4fd5a92)にまとめています。

[（その１）【ピースの配置】](https://qiita.com/alkn203/items/70c09abc21c60bf75899)←　→[（その３）【ピースのタッチ】](https://qiita.com/alkn203/items/4923f912fc85940fdccb)

## 今回の目標
前回は、15パズルのピースの配置を行いました。今回は、以下のように15パズルのピースに数字を表示します。

![15puzzle-tut-2.png](https://qiita-image-store.s3.amazonaws.com/0/67114/638cd05e-b1d3-b9d1-4b5d-c52f7f2be65f.png)

コードは以下のとおりです。

```js
phina.globalize();
// 定数
var SCREEN_WIDTH = 640;            // 画面横サイズ
var SCREEN_HEIGHT = 960;           // 画面縦サイズ
var GRID_SIZE = SCREEN_WIDTH / 4;  // グリッドのサイズ
var PIECE_SIZE = GRID_SIZE * 0.95; // ピースの大きさ
var PIECE_NUM_XY = 4;              // 縦横のピース数
var PIECE_OFFSET = GRID_SIZE / 2;  // オフセット値
// メインシーン
phina.define('MainScene', {
  superClass: 'DisplayScene',
  // コンストラクタ
  init: function() {
    // 親クラス初期化
    this.superInit();
    // 背景色
    this.backgroundColor = 'gray';
    // グリッド
    var grid = Grid(SCREEN_WIDTH, PIECE_NUM_XY);
    // ピースグループ
    var pieceGroup = DisplayElement().addChildTo(this);
    // ピース配置
    PIECE_NUM_XY.times(function(spanX) {
      PIECE_NUM_XY.times(function(spanY) {
        // 番号
        var num = spanY * PIECE_NUM_XY + spanX + 1;
        // ピース作成
        var piece = Piece(num).addChildTo(pieceGroup);
        // Gridを利用して配置
        piece.x = grid.span(spanX) + PIECE_OFFSET;
        piece.y = grid.span(spanY) + PIECE_OFFSET;
        // 16番のピースは非表示
        if (num === 16) piece.hide();
      });
    });
  },
});
// ピースクラス
phina.define('Piece', {
  // RectangleShapeを継承
  superClass: 'phina.display.RectangleShape',
    // コンストラクタ
    init: function(num) {
      // 親クラス初期化
      this.superInit({
        width: PIECE_SIZE,
        height: PIECE_SIZE,
        cornerRadius: 10,
        fill: 'silver',
        stroke: 'white',
      });
      // 数字
      this.num = num;
      // 数字表示用ラベル
      this.label = Label({
        text: this.num + '',
        fontSize: PIECE_SIZE * 0.8,
        fill: 'white',
      }).addChildTo(this);
    },
});
// メイン
phina.main(function() {
  var app = GameApp({
    startLabel: 'main',
  });
  app.run();
});
```
<a href="http://runstant.com/alkn203/projects/7c4b18ba" target="_blank">[runstantで確認]</a>

## コード説明
### 数字の表示
数字の表示には、**Label**クラスを使います。そのために、**Piece**クラスを以下のように変更します。

```js
// ピースクラス
phina.define('Piece', {
  // RectangleShapeを継承
  superClass: 'RectangleShape',
    // コンストラクタ
    init: function(num) {
      // 親クラス初期化
      this.superInit({
        width: PIECE_SIZE,
        height: PIECE_SIZE,
        cornerRadius: 10,
        fill: 'silver',
        stroke: 'white',
      });
      // 数字
      this.num = num;
      // 数字表示用ラベル
      this.label = Label({
        text: this.num + '',
        fontSize: PIECE_SIZE * 0.8,
        fill: 'white',
      }).addChildTo(this);
    },
});
```

* **init**関数に**num**という引数を作成し、初期化時に数字を与えるようにします。
* **this.num**に与えらえた値を保持させます。
* **Label**の**text**プロパティに与えられた数字を設定して、**addChildTo**で**this**(Piece)に追加します。併せて、フォントサイズと色を設定しています。ピースの子要素としてラベルを追加しておけば、ピースが動いた時もラベルが追従するようになります。

### 数字の計算

```js
// ピース配置
PIECE_NUM_XY.times(function(spanX) {
  PIECE_NUM_XY.times(function(spanY) {
    // 番号
    var num = spanY * PIECE_NUM_XY + spanX + 1;
    // ピース作成
    var piece = Piece(num).addChildTo(pieceGroup);
    // Gridを利用して配置
    piece.x = grid.span(spanX) + PIECE_OFFSET;
    piece.y = grid.span(spanY) + PIECE_OFFSET;
    // 16番のピースは非表示
    if (num === 16) piece.hide();
  });
});
```

* 数字は、**MainScene**のピースを配置するループ処理で正しい値になるように計算して、**Piece**に引数として与えます。
* ループでは16番までの数字が作成されますが、15パズルでは16番は不要ですので、条件で16番のピースは空白とみなして**hide**を使って非表示にしています。

## 今回はここまで
ここまでで、各ピースの中心に数字が表示されるようになりました。
次回は、ピースにタッチイベントを追加したいと思います。

[（その１）【ピースの配置】](https://qiita.com/alkn203/items/70c09abc21c60bf75899)←　→[（その３）【ピースのタッチ】](https://qiita.com/alkn203/items/4923f912fc85940fdccb)



## はじめに
このチュートリアルでは、メジャーなスライドパズルである**15パズル**を**phina.js**で作っていきます。

## 今回の目標
以下のように、15パズルのピースを配置します。

![15puzzle-tut-1.png](https://qiita-image-store.s3.amazonaws.com/0/67114/25a75b28-ec5e-3af0-ddd5-b9a759432cf5.png)

全体コードは以下のとおりです。

## 全体コード
::: details コードを見る

```js
// グローバルに展開
phina.globalize();
// 定数
var SCREEN_WIDTH = 640;            // 画面横サイズ
var SCREEN_HEIGHT = 960;           // 画面縦サイズ
var GRID_SIZE = SCREEN_WIDTH / 4;  // グリッドのサイズ
var PIECE_SIZE = GRID_SIZE * 0.95; // ピースの大きさ
var PIECE_NUM_XY = 4;              // 縦横のピース数
var PIECE_OFFSET = GRID_SIZE / 2;  // オフセット値
/*
 * メインシーン
 */
phina.define('MainScene', {
  superClass: 'DisplayScene',
  // コンストラクタ
  init: function() {
    // 親クラス初期化
    this.superInit();
    // 背景色
    this.backgroundColor = 'gray';
    // グリッド
    var grid = Grid(SCREEN_WIDTH, PIECE_NUM_XY);
    // ピースグループ
    var pieceGroup = DisplayElement().addChildTo(this);
    // ピース配置
    PIECE_NUM_XY.times(function(spanX) {
      PIECE_NUM_XY.times(function(spanY) {
        // ピース作成
        var piece = Piece().addChildTo(pieceGroup);
        // Gridを利用して配置
        piece.x = grid.span(spanX) + PIECE_OFFSET;
        piece.y = grid.span(spanY) + PIECE_OFFSET;
      });
    });
  },
});
/*
 * ピースクラス
 */
phina.define('Piece', {
  // RectangleShapeを継承
  superClass: 'RectangleShape',
    // コンストラクタ
    init: function() {
      // 親クラス初期化
      this.superInit({
        width: PIECE_SIZE,
        height: PIECE_SIZE,
        cornerRadius: 10,
        fill: 'silver',
        stroke: 'white',
      });
    },
});
/*
 * メイン処理
 */
phina.main(function() {
  // アプリケーションを生成
  var app = GameApp({
    // MainScene から開始
    startLabel: 'main',
  });
  // 実行
  app.run();
});
```
:::

## runstantプロジェクト
<https://runstant.com/alkn203/projects/bf291944">

## コード説明
### 定数の定義
メインシーンの前にピースサイズなどを定数として定義します。

```js
// 定数
var SCREEN_WIDTH = 640;            // 画面横サイズ
var SCREEN_HEIGHT = 960;           // 画面縦サイズ
var GRID_SIZE = SCREEN_WIDTH / 4;  // グリッドのサイズ
var PIECE_SIZE = GRID_SIZE * 0.95; // ピースの大きさ
var PIECE_NUM_XY = 4;              // 縦横のピース数
var PIECE_OFFSET = GRID_SIZE / 2;  // オフセット値
```

### ピースクラスの定義
後々の利便性を考え、**phina.define**で以下のようにクラス化します。

```js
// ピースクラス
phina.define('Piece', {
  // RectangleShapeを継承
  superClass: 'RectangleShape',
    // コンストラクタ
    init: function() {
      // 親クラス初期化
      this.superInit({
        width: PIECE_SIZE,
        height: PIECE_SIZE,
        cornerRadius: 10,
        fill: 'silver',
        stroke: 'white',
      });
    },
});
```

* **Piece**クラスは**phina.js**で最初から用意されている**RectangleShape**（矩形）クラスを継承し、**init**関数内で親クラス(RectangleShape）にパラメータを渡して初期化しています。
* ピースは正方形ですので、**width**と**height**には同じ**PIECE_SIZE**を与えています。
* **cornerRadius**プロパティを設定することで、角丸の四角形にすることができます。
* **fill**は塗りつぶしの色、**stroke**は枠の色です。
* **phina.js**には他にも円や三角形などの**Shape**（基本図形）が用意されており、どれも最小限のパラメータで描画することができるので、簡単な動作確認の際に重宝します。

https://zenn.dev/alkn203/books/phina-js-tips/viewer/sort-of-shape

### ピースの配置
今回の目的であるピースの配置について説明します。

```js
// グリッド
var grid = Grid(SCREEN_WIDTH, PIECE_NUM_XY);
// ピースグループ
var pieceGroup = DisplayElement().addChildTo(this);
// ピース配置
PIECE_NUM_XY.times(function(spanX) {
  PIECE_NUM_XY.times(function(spanY) {
    // ピース作成
    var piece = Piece().addChildTo(pieceGroup);
    // Gridを利用して配置
    piece.x = grid.span(spanX) + PIECE_OFFSET;
    piece.y = grid.span(spanY) + PIECE_OFFSET;
  });
});
```

* 画面幅をピースの並び数で区割りした**Grid**を作成しています。

Gridについて
https://zenn.dev/alkn203/articles/phina-use-grid

* **DisplayElement**クラスを使って、**pieceGroup**という名前のグループを作っています。

グループ監理について
https://zenn.dev/alkn203/articles/phina-groupmanagement

* ピースの配置は2重ループ処理で行いますが、今回は、**phina.js**独自の**times**メソッドを使用しています。**PIECE_NUM_XY**には**4**という数値が入っていますので、引数で与えられた**function**内の処理を**4回繰り返す**という意味になります。**spanX**と**spanY**には、インデックス値である**0～3**の数値がループ処理で入ってきますので、これを利用します。
* 次にピースを作成して、先に作った**pieceGroup**に追加しています。
* 最後に、グリッドを利用してピースを配置しています。定数の定義部分でグリッドのサイズよりピースのサイズを少し小さくしていますが、これにより**padding**に似た効果を得ることができます。なお、**phina.js**でのオブジェクトの座標値はオブジェクトの原点（デフォルトではオブジェクトの中心）となりますので、**PIECE_OFFSET**で位置を調整しています。**PIECE_OFFSET**の箇所を削除して実行してみると、結果の違いが分かるかと思います。
* 作成した**pieceGroup**を**MainScene**に**addChildTo**することで、ピースが画面に表示されます。

